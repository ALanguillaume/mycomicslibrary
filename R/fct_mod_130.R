# WARNING - Generated by {fusen} from dev/flat_mod130.Rmd: do not edit by hand

#' Prepare comics database to see collection
#' @return a comics database with only the columns needed to see the collection
#' @rdname fct_mod_130
#' @importFrom dplyr select mutate
#' @importFrom shiny selectInput
#' @export
prepare_comics_db_to_see_collection <- function(comics_db, ns) {
  db <- comics_db |>
    select(
      titre,
      date_publication,
      nb_pages,
      editeur,
      note,
      type_publication,
      statut,
      lien_cover,
      ISBN
    )

  selectinput_statut <- sapply(seq_len(nrow(db)), function(i) {
    selectInput(
      inputId = ns(paste0("statut", i)),
      label = NULL,
      choices = c("A lire", "En cours", "Lu"),
      selected = db$statut[i]
    ) |>
      as.character()
  })

  selectinput_typepublication <- sapply(seq_len(nrow(db)), function(i) {
    selectInput(
      inputId = ns(paste0("type_publication", i)),
      label = NULL,
      choices = c("Comics", "BD", "Roman graphique", "Autre"),
      selected = db$type_publication[i]
    ) |>
      as.character()
  })

  selectinput_note <- sapply(seq_len(nrow(db)), function(i) {
    selectInput(
      inputId = ns(paste0("note", i)),
      label = NULL,
      choices = c("Comics", "BD", "Roman graphique", "Autre"),
      selected = db$note[i]
    ) |>
      as.character()
  })

  validate_buttons <- sapply(seq_len(nrow(db)), function(i) {
    sprintf(
      '<button type="button" class="btn btn-primary" id="%s" onclick="%s">Enregistrer</button>',
      ns(paste0("button", i)),
      sprintf(
        "Shiny.setInputValue(
        '%s',
        '%s',
        {priority : 'event'}
      );
      Shiny.setInputValue(
        '%s',
        Math.random(),
        {priority : 'event'}
      );",
        ns("button_clicked_id"),
        ns(paste0("button", i)),
        ns("button_clicked")
      )
    )
  })

  # impl√©menter des selectInput pour les statuts
  db$statut <- selectinput_statut
  db$type_publication <- selectinput_typepublication
  db$validate <- validate_buttons

  db
}
